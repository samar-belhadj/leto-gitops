podTemplate(
  inheritFrom: 'jenkins-agent',
  containers: [
    containerTemplate(name: 'docker-container', image: 'docker:19.03.1-dind', alwaysPullImage: false, ttyEnabled: true, command: 'cat'),
    containerTemplate(name: 'node-container', image: 'bitnami/node:18.4.0', alwaysPullImage: false, ttyEnabled: true, command: 'cat')
  
]
){
  node(POD_LABEL) {
    
    stage('Checkout leto project') {
        checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'leto-modelizer']], userRemoteConfigs: [[url: 'https://github.com/ditrit/leto-modelizer.git']]])
        //checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'leto-modelizer-plugin-core']], userRemoteConfigs: [[url: 'https://github.com/samar-belhadj/leto-modelizer-plugin-core.git']]])
        checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'leto-modelizer-plugin-cli']], userRemoteConfigs: [[url: 'https://github.com/ditrit/leto-modelizer-plugin-cli.git']]])
        //checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'jenkinator-plugin']], userRemoteConfigs: [[url: 'https://github.com/samar-belhadj/jenkinator-plugin.git']]])
        //checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'terrator-plugin']], userRemoteConfigs: [[url: 'https://github.com/samar-belhadj/terrator-plugin.git']]])
        //checkout([$class: 'GitSCM', branches: [[name: "main"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'kubernator-plugin']], userRemoteConfigs: [[url: 'https://github.com/samar-belhadj/kubernator-plugin.git']]])
        // checkout([$class: 'GitSCM', branches: [[name: "${GITHUBATOR_BRANCH}"]], extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: 'githubator-plugin']], userRemoteConfigs: [[credentialsId: 'byo-wiki-github', url: 'https://sgithub.fr.world.socgen/dds-itf-acid/githubator-plugin.git']]])
      
    }
    stage('Checkout cicd folder') {
      dir('leto-gitops'){
        checkout scm
      }
    }
   
    
    stage('Build / Tests') {
      container('node-container') {
        
          dir('leto-modelizer') {
            sh """
            rm package-lock.json
            npm install -g npm@8.19.3
            node -v
            npm -v
            cat package.json
            npm install
            npm run build
            """
          }
         
        
      }
    }
    

   
  }
}